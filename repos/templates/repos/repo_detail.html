{% extends "base.html" %}

{% block title %}
{{ repo.owner.username }}/{{ repo.name }}
{% endblock %}

{% block content %}





<div class="repo-header">
  <div>
    <h2>{{ repo.owner.username }}/{{ repo.name }}</h2>
    <div style="color:#8b949e;">
      {{ repo.description|default:"No description provided." }}
    </div>
  </div>

  <div>
    {% if repo.is_private %}
      <span class="btn-secondary">Private</span>
    {% else %}
      <span class="btn-secondary">Public</span>
    {% endif %}
  </div>
</div>





<div class="tabs">
  <a href="{% url 'repos:detail' repo.id %}" class="active">Code</a>
  <a href="{% url 'repos:repo_issues' repo.id %}">Issues</a>
  <a href="{% url 'repos:repo_pulls' repo.id %}">Pull Requests</a>
  <a href="{% url 'repos:repo_commits' repo.id %}">Commits</a>
  <a href="{% url 'repos:repo_branches' repo.id %}">Branches</a>
  <a href="{% url 'repos:repo_ci' repo.id %}">CI</a>
  <a href="{% url 'repos:repo_security' repo.id %}">Security</a>
  <a href="{% url 'repos:repo_settings' repo.id %}">Settings</a>
</div>





<div class="grid">

  

  
  <div>

    
    <div class="card" style="display:flex; gap:10px; flex-wrap:wrap;">

      {% if default_branch %}
        <a class="btn" href="{% url 'commits:push' repo.id default_branch.id %}">
          Push Code
        </a>
      {% endif %}

      <a class="btn-secondary" href="{% url 'repos:pull' repo.id %}">
        Download ZIP
      </a>

      <a class="btn-secondary" href="{% url 'branches:create' repo.id %}">
        Create Branch
      </a>

      <a class="btn-secondary" href="{% url 'branches:merge' repo.id %}">
        Merge Branches
      </a>
    </div>


    <!-- Code Section -->
    <div class="card">

      <div style="margin-bottom:10px; color:#8b949e;">
        Branch:
        {% if default_branch %}
          <strong>{{ default_branch.name }}</strong>
        {% else %}
          <span>No default branch</span>
        {% endif %}
      </div>

      {% if file_tree and default_branch %}
        {% include "repos/_file_tree.html" with tree=file_tree repo=repo branch=default_branch %}
      {% else %}
        <p>This repository is empty.</p>
      {% endif %}
    </div>


    <!-- Recent Commit Preview -->
    <div class="card">
      <h3>Recent Commits</h3>

      {% if commits %}
        {% for commit in commits|slice:":5" %}
          <div style="margin-bottom:12px;">
            <a href="{% url 'commits:detail' commit.id %}">
              <strong>{{ commit.message }}</strong>
            </a>
            <div style="color:#8b949e; font-size:13px;">
              {{ commit.created_at|date:"M d, Y H:i" }}
              — {{ commit.author.username }}
            </div>
          </div>
        {% endfor %}

        <a href="{% url 'repos:repo_commits' repo.id %}">
          View all commits →
        </a>

      {% else %}
        <p>No commits yet.</p>
      {% endif %}
    </div>

  </div>


  
  <!-- Right Sidebar -->
  
  <div>

    <div class="card">
      <h3>About</h3>

      <p>{{ repo.description|default:"No description provided." }}</p>

      <hr style="border:1px solid #30363d; margin:15px 0;">

      <p>
        <strong>Visibility:</strong>
        {% if repo.is_private %}Private{% else %}Public{% endif %}
      </p>

      {% if default_branch %}
        <p>
          <strong>Default branch:</strong>
          {{ default_branch.name }}
        </p>
      {% endif %}

      <p>
        <strong>Created:</strong>
        {{ repo.created_at|date:"M d, Y" }}
      </p>
    </div>

  </div>

</div>

{% endblock %}
